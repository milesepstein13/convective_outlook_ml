This project trains an ML model to predict biases (from [https://github.com/milesepstein13/severe-thunderstorm-analysis](https://github.com/milesepstein13/severe-thunderstorm-analysis)) in SPC Convective Outlooks from ERA5 reanalysis.

1) `download_inputs.ipynb` downloads a specified subset of ERA5 data from [arco-era5 on Google Cloud](https://github.com/google-research/arco-era5). Use detail to specify level of detail (spatial/temporal domain, which variables). Saves file as `/glade/work/milesep/convective_outlook_ml/inputs_raw_[detail].zarr`. `detail = 'full'` results in file size of 42 GB. `detail = 'small'` results in file size of <1GB--preferred for testing. Runtime: < 1 minute until saving, which takes: 

2) `prepare_inputs.ipynb` opens raw ERA5 data from `/glade/work/milesep/convective_outlook_ml/inputs_raw_[detail].zarr` and splits into training (-2019) and test (2020-). Computes daily mean and std values for each variable/pressure level (across all of time and space) across training data and saves these means and stds to `data/processed_data/daily_input_stats_[detail].nc`. Then standardizes test and training sets by the overall training mean/std to `/glade/work/milesep/convective_outlook_ml/[train/test]_inputs_[detail].zarr`.

3) `prepare_targets.ipynb` opens contingency table values from `data/raw_data/contingency_regions.nc` and labelled PPH from `data/raw_data/labelled_pph.nc` (see [previous work](https://github.com/milesepstein13/severe-thunderstorm-analysis)) to prepare target variable dataset. Target variables are daily `(b-c)`, northward shift, and eastward shift for each hazard type. Each variable/hazard is split into training (-2019) and test (2020-) sets, and training sets are detrended such that the line of best fit is constant at the final value of the raw training line of best fit (2019-05-20)--enforcing that we cannot assume a change of SPC forecast practices into the future. Final dataset is saved as `data/processed_data/train_targets.nc`

4) `train_models.ipynb` Trains each reqested model and saves trained models and test/val curves. Model design specified in `src/`

5) `compare_models.ipynb` Compares trained model performance.